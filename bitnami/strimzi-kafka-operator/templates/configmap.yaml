{{- /*
Copyright Broadcom, Inc. All Rights Reserved.
SPDX-License-Identifier: APACHE-2.0
*/}}

{{/* Adding the helper in here for better readability */}}
{{- define "strimzi.configuration" -}}
{{- if .Values.logConfiguration }}
{{- include "common.tplvalues.render" (dict "value" .Values.logConfiguration "context" .) }}
{{- else }}
name: COConfig
monitorInterval: 30
appender.console.type: Console
appender.console.name: STDOUT
appender.console.layout.type: PatternLayout
appender.console.layout.pattern: "%d{yyyy-MM-dd HH:mm:ss} %-5p %c{1}:%L - %m%n"
rootLogger.level: {{ .Values.logLevel }}
rootLogger.appenderRefs: stdout
rootLogger.appenderRef.console.ref: STDOUT
# Kafka AdminClient logging is a bit noisy at INFO level
logger.kafka.name: org.apache.kafka
logger.kafka.level: WARN
# Keeps separate level for Netty logging -> to not be changed by the root logger
logger.netty.name: io.netty
logger.netty.level: INFO
{{- end }}
{{- end }}

{{- if not .Values.existingLogConfigmap }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ template "common.names.fullname" . }}
  namespace: {{ include "common.names.namespace" . | quote }}
  labels: {{- include "common.labels.standard" (dict "customLabels" .Values.commonLabels "context" .) | nindent 4 }}
    app.kubernetes.io/part-of: strimzi-kafka-operator
    app.kubernetes.io/component: operator
  {{- if .Values.commonAnnotations }}
  annotations: {{- include "common.tplvalues.render" (dict "value" .Values.commonAnnotations "context" .) | nindent 4 }}
  {{- end }}
data:
  {{- $logConfiguration := include "strimzi.configuration" . | fromYaml -}}
  {{- if .Values.overrideLogConfiguration }}
  {{- $overrideConfiguration := include "common.tplvalues.render" (dict "value" .Values.overrideLogConfiguration "context" .) | fromYaml }}
  {{- $logConfiguration = mustMergeOverwrite $logConfiguration $overrideConfiguration }}
  {{- end }}
  log4j2.properties: |
    {{- range $key, $val := $logConfiguration }}
    {{ $key }} = {{ $val }}
    {{- end }}
{{- end }}
